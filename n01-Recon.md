# 01 - Recon

- [01 - Recon](#01---recon)
  - [Introduction](#introduction)
  - [Azure Tenant](#azure-tenant)
  - [Azure Tenant recon using ADDInternals Tools](#azure-tenant-recon-using-addinternals-tools)

---

## Introduction

Assume we only know the domain name or email addresses of the target organization `decorphq`.

We can extract some interesting information:

- If the target organization uses Azure tenant 
- Tenant ID 
- Tenant name 
- Authentication type (Federation or not) 
- Domains 
- Azure Services used by the target organization  
- Guess email IDs

<br/>

---

## Azure Tenant

To see if an Azure Tenant exists, and if yes, get the tenant name and Federation:

```
curl https://login.microsoftonline.com/getuserrealm.srf?login=<USERNAME@DOMAIN>&xml=1
```

<br/>

To get the tenant ID:

```
curl https://login.microsoftonline.com/<DOMAIN>/.well-known/openid-configuration
```

<br/>

To validate Email ID:

```
curl https://login.microsoftonline.com/common/GetCredentialType
```

<br/>

---

## Azure Tenant recon using ADDInternals Tools

For AzureAD recon, we can use the ADDInternals tool, a PowerShell module that we can use for multiple attacks against AzureAD:

- https://github.com/Gerenios/AADInternals

To import the module:
```
Import-Module .\ADDInternals.psd1 -Verbose
```

<br/>

Get tenant name, authentication, brand name (usually same as directory name) and domain name:

```
Get-AADIntLoginInformation -UserName root@defcorphq.onmicrosoft.com
```

![picture 1](images/e849f86638eca62b7eb66d12f15b5c6115db614027a07d979027af9b0e79f2db.png)  

<br/>

Get tenant ID

```
Get-AADIntTenantID -Domain defcorphq.onmicrosoft.com
```

![picture 2](images/920ccb6004362c7ba15ae058d0ad66e8a5a0129419a5d078f126519255558e45.png)  

<br/>

Get tenant domains

```
Get-AADIntTenantDomains -Domain defcorphq.onmicrosoft.com 

Get-AADIntTenantDomains -Domain deffin.onmicrosoft.com
```

![picture 3](images/53501f237f78f853b80d226d75e9fec9a1ca887e1948f66404e4e1f844fee3bb.png)  

<br/>

Get all the information

```
Invoke-AADIntReconAsOutsider -DomainName defcorphq.onmicrosoft.com

Invoke-AADIntReconAsOutsider -DomainName deffin.onmicrosoft.com
```

![picture 4](images/a700022e8f7a66c7558c4a09b7d3ad745da43d58a9c26d1e11159805553dfaf5.png)  

![picture 5](images/c388da7b5ec90b21d9674b3ae292894e714b1f30af9111c5ebaee4ae21b28059.png)  


<br/>

