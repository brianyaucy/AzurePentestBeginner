# 03 - Enumerations

- [03 - Enumerations](#03---enumerations)
  - [Azure Portal](#azure-portal)
  - [Default user permissions](#default-user-permissions)
  - [AzureAD Module](#azuread-module)
  - [AzureAD Module - Users](#azuread-module---users)
  - [AzureAD Module - Groups](#azuread-module---groups)

---

## Azure Portal

The Azure Portal (https://portal.azure.com/) is a web console that can be used to manage Azure account and its resources.

It is a GUI alternative to tools like PowerShell modules and Azure cli.

<br/>

---

## Default user permissions

A normal user has many interesting permissions in Azure AD!

- Read all users, Groups, Applications, Devices, Roles, Subscriptions, and their public properties
- Invite Guests
- Create Security groups
- Read non-hidden Group memberships
- Add guests to Owned groups
- Create new application
- Add up to 50 devices to Azure

<br/>

---

## AzureAD Module

AzureAD is a PowerShell module from Microsoft for managing Azure AD. It does not show all the properties of Azure AD objects and the documentation is not good. Still useful to some extent!

It can be used only to interact with Azure AD, no access to Azure resources. 

Please note that if the module is not present on your machine, you can use `Install-Module AzureAD` command (needs internet). Alternatively, Download it from PowerShell Gallery, rename the `.nukpkg` to `.zip` and extract it:

- https://www.powershellgallery.com/packages/AzureAD

```
Import-Module C:\AzAD\Tools\AzureAD\AzureAD.psd1
```

<br/>

To be able to use PowerShell module, we must connect to Azure AD first:

```
$passwd = ConvertTo-SecureString "SuperVeryEasytoGuessPassword@1234" -AsPlainText -Force

$creds = New-Object System.Management.Automation.PSCredential("test@defcorphq.onmicrosoft.com", $passwd)

Connect-AzureAD -Credential $creds
```

![picture 28](images/ec47975fac9875b852bd20a6d7b3f3e237b4dcacf0b6c41587ea3efac3a3ef90.png)  

<br/>

To get the current session state:

```
Get-AzureADCurrentSessionInfo
```

![picture 30](images/c137cdd61725d59ce4fc12af7d6d7b12fd942e633a04bb7020c355046f123051.png)  

<br/.>

To get details of the current tenant:

```
Get-AzureADTenantDetail
```

![picture 31](images/0a8c55e38dbdac6cb19c1875073b05bd89bdd7bcbb3374bd6bc8d9012dd5a06d.png)  


<br/>

---

## AzureAD Module - Users

To enumerate all users:

```
Get-AzureADUser -All $true

Get-AzureADUser -All $true | Export-Csv -Path C:\Users\studentuser190\Desktop\users.csv
```

![picture 29](images/655ee7f97c952ed4f295d3d73bb69977283eee976a62a0b93c3a58d62bfe0fd4.png)  


<br/>

Enumerate a specific user:

```
Get-AzureADUser -ObjectId test@defcorphq.onmicrosoft.com

Get-AzureADUser -ObjectId test@defcorphq.onmicrosoft.com | Select *
```

![picture 32](images/47cf219f0c9c42f002ef3ff57b744e816a57368bf33c97d408abcaa9362ff399.png)  

![picture 33](images/14971db2de3621f66047cfcdab2213ebb060f2eb978244935feda83d39f93656.png)  

<br/>

Search for a user based on string in first characters of `DisplayName` or `userPrincipalName` (**wildcard not supported**):

```
Get-AzureADUser -SearchString "admin"
```

![picture 34](images/578157563172c17ea0fb10149a1c3fa80b08c20409d5744aa74eb2fcb464472d.png)  

<br/>

Search for users who contain the word "admin" in their Display name:

```
Get-AzureADUser -All $true |?{$_.Displayname -match "admin"}
```

![picture 35](images/aae92327552c3bf63cc9c99b74fe31f81671399c581a9c35e9524772a48bd108.png)  

<br/>

List all the attributes for a user:

```
Get-AzureADUser -ObjectId test@defcorphq.onmicrosoft.com | fl *

Get-AzureADUser -ObjectId test@defcorphq.onmicrosoft.com | %{$_.PSObject.Properties.Name}
```

![picture 36](images/0fabd8bf9be8985ced4a78d9a3d4aa4d9a9fe8b70bf540b8078e42b592d86c5d.png)  

![picture 37](images/9f5e3fa344f83eba0961b14fd7016e009b460503f670286f1b1989b001461cb0.png)  

<br/>

Search attributes for all users that contain the string "password":

```
Get-AzureADUser |%{$Properties = $_;$Properties.PSObject.Properties.Name | % {if ($Properties.$_ -match 'password') {"$($Properties.UserPrincipalName) -$_ -$($Properties.$_)"}}}
```

<br/>

All users who are synced from on-prem

```
Get-AzureADUser -All $true | ?{$_.OnPremisesSecurityIdentifier -ne $null}
```

<br/>

All users who are from Azure AD

```
Get-AzureADUser -All $true | ?{$_.OnPremisesSecurityIdentifier -eq $null}
```

![picture 38](images/1a2ca252959be0fc695366fda7c9b1372f04c6c9739e6e080b1a3d7972d2ba18.png)  


<br/>

Objects created by any user (use `-ObjectId` for a specific user).
(This take some time to run.)

```
Get-AzureADUser | Get-AzureADUserCreatedObject
```

![picture 39](images/0cdece74662eb9a413e133db36908fdf6acf05131cd8e9a3a631d42d6a07c30e.png)  

<br/>

Objects owned by a specific user:

```
Get-AzureADUserOwnedObject -ObjectId test@defcorphq.onmicrosoft.com
```

![picture 40](images/941bb22c95c4005826963bb7cc0ff1671c14f699ed2182be2c56b4346002a52b.png)  

<br/>

---

## AzureAD Module - Groups

